<div class="inner-content-wrapper">
	<div class="main-content">
		<div class="container wrapper">
			<h1><i class="fa fa-unlock-alt"></i> Moderation Panel</h1>
			<p>This page is designed so your mods can manage your music queue, without spamming chat with a bunch of messages!</p>
			<div class="moderation-messages"></div>
			<div class="control-buttons moderation">
				<div class="volumeContainer clearfix">
					<div class="slider">
						<div class="linktoshare">
							<span>Link To Share: </span>
							<input type="text" readonly="readonly" value="" class="linktoshareinput darkinput" />
						</div>
						<input type="range" id="volumeRange" value="" max="100" min="0" step="5" onchange="updateRangeVolume(this.value)" />
						<input type="text" name="volumeInput" id="volumeInput" class="currentvolume darkinput" disabled />
					</div>
					<div class="buttons">
						<button type="button" class="blue-styled-button volBtn" id="down">
							<i class="fa fa-volume-down" title="Volume -10"></i>
						</button>
						<button type="button" class="blue-styled-button volBtn" id="up">
							<i class="fa fa-volume-up" title="Volume +10"></i>
						</button>
						<button type="button" class="blue-styled-button togglePlay">
							<i class="fa fa-pause" title="Pause"></i>
						</button>
					</div>
				</div>
			</div>
			<div class="song-container">
					<table class="datatable moderation">
						<thead>
							<th class="moderation-number">#</th>
							<th class="datatable-half">Title</th>
							<th>Requested</th>
							<th></th>
						</thead>
						<tbody></tbody>
					</table>
					<div class="nosongs"></div>
			</div>
			<div class="chatbox"></div>
			<div class="details">
				<div class="messagesFromBot clear"></div>
			</div>
		</div>
	</div>
</div>
<script src="https://ttv-api.s3.amazonaws.com/twitch.min.js"></script>
<script>
	const loggedInChannel = userDetails[2];

	async function initModeration() {
		showLoader($('.nosongs'));
		const songlist = await loadFormattedSonglist(channelData,'moderation');
		hideLoader($('.nosongs'));
		const currentVolume = await getVolume(channelData);
		const replacedChannel = channelName.replace('#','/');

		if (getUrl.href.includes(replacedChannel)) {
			$('.linktoshareinput').val(getUrl);
		} else {
			$('.linktoshareinput').val(getUrl + channelName.replace('#','/'));
		};

		if (songlist) {
			dataTableStartSize = '25';
			buildDataTable(songlist,'.datatable',dataTableStartSize);
			$('.nosongs').hide();
		} else {
			$('.nosongs').html("Currently no songs in the queue!");
		};

		$('#volumeInput,#volumeRange').val(currentVolume);
		$("#volumeRange").mousemove(function () {
			$("#volumeInput").val($("#volumeRange").val());
		});

		loadTwitchChatIframe(channelName);
		applyMusicStatus(channelData);
		handlePlayPauseClick($('.togglePlay'));
		handleVolumeClick($('.volBtn'));
	};

	function loadTwitchChatIframe(channelName) {
		if (channelName.includes('#')) {channelName = channelName.slice(1);};
		const chatPanel = '<iframe frameborder="0" scrolling="no" id="chat_embed" src="http://www.twitch.tv/' + channelName + '/chat"></iframe>';
		$('.chatbox').html(chatPanel);
	};

	async function updateRangeVolume(newVol) {
		await updateVolume(channelData,newVol);
	};

	$('body').on('click', '.removeButton', async function(e) {
		const removeSongData = await removeSong($(this).attr('id'),channelName,loggedInChannel);
		if (removeSongData != 'song removed') {
			$('.messagesFromBot').html('<p>There was an error removing that song, please try again!</p>').fadeIn('fast');
			setTimeout(function(){
				$('.messagesFromBot').fadeOut("slow");
			},2000);
		};
	});

	$('body').on('click', '.promoteButton', async function(e) {
		const promoteSongData = await promoteSong($(this).attr('id'),channelName,loggedInChannel);
		if (promoteSongData != 'song promoted') {
			$('.messagesFromBot').html('<p>There was an error promoting that song, please try again!</p>').fadeIn('fast');
			setTimeout(function(){
				$('.messagesFromBot').fadeOut("slow");
			},2000);
		};
	});

	initModeration();
</script>