!function(t){var e=401,n={$:t,baseUrl:"https://api.twitch.tv/kraken/",_config:{},extend:function(e){t.extend(n,e)},api:function(i,o){if(!n._config.session)throw new Error("You must call init() before api()");var s=i.params||{};o=o||function(){};var r=!!n._config.session.token,c=n.baseUrl+(i.url||i.method||"");r&&(s.oauth_token=n._config.session.token),i.verb&&(s._method=i.verb),t.ajax({url:c+"?"+t.param(s),dataType:"jsonp",timeout:5e3}).done(function(t){n.log("Response Data:",t),t&&t.error?(n.log("API Error:",t.error+";",t.message),r&&t.status===e?n.logout(function(){o(t,null)}):o(t,null)):o(null,t||null)}).fail(function(){o(new Error("Request Timeout"),null)})},log:function(t){Array.prototype.unshift.call(arguments,"[Twitch]"),window.console&&console.log.apply(console,arguments)}};window.Twitch=n}(window.jQuery||window.Zepto),function(){var t=window.sessionStorage;t||(t=new function(t){function e(t,e,n){var i,o;n?((i=new Date).setTime(i.getTime()+24*n*60*60*1e3),o="; expires="+i.toGMTString()):o="",document.cookie=t+"="+e+o+"; path=/"}function n(n){n=JSON.stringify(n),"session"==t?window.name=n:e("localStorage",n,365)}var i=function(){var e="session"==t?window.name:function(t){var e,n,i=t+"=",o=document.cookie.split(";");for(e=0;e<o.length;e++){for(n=o[e];" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(i))return n.substring(i.length,n.length)}return null}("localStorage");return e?JSON.parse(e):{}}();return{length:0,clear:function(){i={},this.length=0,"session"==t?window.name="":e("localStorage","",365)},getItem:function(t){return void 0===i[t]?null:i[t]},key:function(t){var e=0;for(var n in i){if(e==t)return n;e++}return null},removeItem:function(t){delete i[t],this.length--,n(i)},setItem:function(t,e){i[t]=e+"",this.length++,n(i)}}}("session")),Twitch.extend({_storage:t})}(),Twitch.extend({init:function(t,e){if(!t.clientId)throw new Error("client id not specified");Twitch._config.clientId=t.clientId,Twitch._initSession(),"function"==typeof e&&Twitch.getStatus(e)}}),function(){var t=Twitch.$,e=function(t){t=t||document.location.hash;var e=function(e){var n=t.match(e);return n?n[1]:null};return{token:e(/access_token=(\w+)/),scope:e(/scope=([\w+]+)/)?e(/scope=([\w+]+)/).split("+"):null,state:e(/state=(\w+)/),error:e(/error=(\w+)/),errorDescription:e(/error_description=(\w+)/)}},n=function(t,e){if("function"==typeof t&&(e=t),"function"!=typeof e&&(e=function(){}),!Twitch._config.session)throw new Error("You must call init() before getStatus()");var n=function(t){return{authenticated:!!t.token,token:t.token,scope:t.scope,error:t.error,errorDescription:t.errorDescription}};t&&t.force?function(t){Twitch.api({method:"/"},function(e,n){if(e)return Twitch.log("error encountered updating session:",e),void(t&&t(e,null));n.token.valid?t&&t(null,void 0):Twitch.logout(t)})}(function(t,i){e(t,n(i||Twitch._config.session))}):e(null,n(Twitch._config.session))};Twitch.extend({_initSession:function(){var t;if(Twitch._config.session={},window.JSON&&(t=Twitch._storage.getItem("twitch_oauth_session")))try{Twitch._config.session=JSON.parse(t)}catch(t){}document.location.hash.match(/access_token=(\w+)/)&&(Twitch._config.session=e(),window.JSON&&Twitch._storage.setItem("twitch_oauth_session",JSON.stringify(Twitch._config.session))),n(function(t,e){e.authenticated&&Twitch.events.emit("auth.login")})},_parseFragment:e,getToken:function(){return Twitch._config.session&&Twitch._config.session.token},getStatus:n,login:function(e){if(!e.scope)throw new Error("Must specify list of requested scopes");var n={response_type:"token",client_id:Twitch._config.clientId,redirect_uri:e.redirect_uri||window.location.href.replace(/#.*$/,""),scope:e.scope.join(" ")};if(!n.client_id)throw new Error("You must call init() before login()");var i=Twitch.baseUrl+"oauth2/authorize?"+t.param(n);e.popup?Twitch._config.loginPopup=window.open(i,"Login with TwitchTV","height=600,width=660,resizable=yes,status=yes"):window.location=i},logout:function(t){Twitch._config.session={},Twitch._storage.removeItem("twitch_oauth_session"),Twitch.events.emit("auth.logout"),"function"==typeof t&&t(null)}})}(),function(){function t(){this._events={},this._maxListeners=10}function e(t,e,n,i,o){this.type=t,this.listener=e,this.scope=n,this.once=i,this.instance=o}e.prototype.fire=function(t){if(this.listener.apply(this.scope||this.instance,t),this.once)return this.instance.removeListener(this.type,this.listener,this.scope),!1},t.prototype.eachListener=function(t,e){var n=null,i=null,o=null;if(this._events.hasOwnProperty(t))for(i=this._events[t],n=0;n<i.length;n+=1)if(!1===(o=e.call(this,i[n],n)))n-=1;else if(!0===o)break;return this},t.prototype.addListener=function(t,n,i,o){return this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(new e(t,n,i,o,this)),this.emit("newListener",t,n,i,o),this._maxListeners&&!this._events[t].warned&&this._events[t].length>this._maxListeners&&(Twitch.log("Possible EventEmitter memory leak detected. "+this._events[t].length+" listeners added. Use emitter.setMaxListeners() to increase limit."),this._events[t].warned=!0),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(t,e,n){return this.addListener(t,e,n,!0)},t.prototype.removeListener=function(t,e,n){return this.eachListener(t,function(i,o){i.listener!==e||n&&i.scope!==n||this._events[t].splice(o,1)}),this._events[t]&&0===this._events[t].length&&delete this._events[t],this},t.prototype.off=t.prototype.removeListener,t.prototype.removeAllListeners=function(t){return t&&this._events.hasOwnProperty(t)?delete this._events[t]:t||(this._events={}),this},t.prototype.listeners=function(t){if(this._events.hasOwnProperty(t)){var e=[];return this.eachListener(t,function(t){e.push(t.listener)}),e}return[]},t.prototype.emit=function(t){var e=[],n=null;for(n=1;n<arguments.length;n+=1)e.push(arguments[n]);return this.eachListener(t,function(t){return t.fire(e)}),this},t.prototype.setMaxListeners=function(t){return this._maxListeners=t,this},Twitch.extend({events:new t})}();