<div class="container wrapper">
	<div class="starter-template">
		<h1><img src="/img/commands.png" alt="" /> Moderation Panel</h1>
		<div class="moderation-messages"></div>
		<div class="song-container">
			<div class="control-buttons moderation clear">
				<div class="volumeContainer clear clearfix">
					<h3>Volume</h3>
					<div class="slider clear">
						<input type="range" id="volumeRange" value="" max="100" min="0" onchange="updateRangeVolume(this.value)" />
						<input type="text" name="volumeInput" id="volumeInput" class="currentvolume" disabled />
					</div>
					<div class="buttons clear">
						<button type="button" class="blue-styled-button volBtn" id="down">Volume -10</button>
						<button type="button" class="blue-styled-button volBtn" id="up">Volume +10</button>
						<button type="button" class="blue-styled-button togglePlay">Pause</button>
						<!-- <button type="button" class="blue-styled-button shuffleBtn" id="shuffle">Shuffle Songs</button> -->
					</div>
				</div>
			</div>
			<div class="moderation-songlist songlist">
				<table class="datatable moderation"><thead><th>#</th><th>Title</th><th>Requested</th><th></th><th></th></thead><tbody></tbody></table>
				<div class="nosongs"></div>
			</div>
		</div>
		<div class="chatbox"></div>
		<div class="details">
			<div class="messagesFromBot clear"></div>
		</div>
	</div>
</div><!-- /.container -->
<script src="https://ttv-api.s3.amazonaws.com/twitch.min.js"></script>
<script>
	async function initModeration() {
		loadModerationPanels(channelName);
		const songlist = await loadSonglist(channelData,'moderation');
		if (songlist) {
			dataTableStartSize = '5';
			buildDataTable(songlist,'.datatable',dataTableStartSize);
			$('.nosongs').hide();
		} else {
			$('.nosongs').html("Currently no songs in the queue!");
		};
		const currentVolume = await getVolume(channelData);
		$('#volumeInput').val(currentVolume);
		$('#volumeRange').val(currentVolume);
		applyMusicStatus(channelData);
	};
	const loggedInChannel = userDetails[2];
	function loadModerationPanels(channelName) {
		if (channelName.includes('#')) {channelName = channelName.slice(1);};
		const chatPanel = '<iframe frameborder="0" scrolling="no" id="chat_embed" src="http://www.twitch.tv/' + channelName + '/chat"></iframe>';
		$('.chatbox').html(chatPanel);
	};

	async function updateRangeVolume(newVol) {
		$('#volumeInput').val(newVol);
		await updateVolume(channelData,newVol);
	}

	$('.togglePlay').click(async function(e) {
		e.preventDefault();
		if ($(this).text() == 'Pause') {
			await updateMusicStatus(channelData,'pause');
			$(this).text('Play');
		} else {
			await updateMusicStatus(channelData,'play');
			$(this).text('Pause');
		};
	});

	$('body').on('click', '.removeButton', async function(e) {
		const removeSongData = await removeSong($(this).attr('id'),channelName,loggedInChannel);
		if (removeSongData != 'song removed') {
			$('.messagesFromBot').html('<p>There was an error removing that song, please try again!</p>').fadeIn("fast");
			setTimeout(function(){
				$('.messagesFromBot').fadeOut("slow");
			},2000);
		};
	});

	$('body').on('click', '.promoteButton', async function(e) {
		const promoteSongData = await promoteSong($(this).attr('id'),channelName,loggedInChannel);
		if (promoteSongData != 'song promoted') {
			$('.messagesFromBot').html('<p>There was an error promoting that song, please try again!</p>').fadeIn("fast");
			setTimeout(function(){
				$('.messagesFromBot').fadeOut("slow");
			},2000);
		};
	});

	$('.volBtn').click(async function(e) {
		e.preventDefault();
		let newVol = await volumeBtnClick($(this));
		await updateVolume(channelData,newVol);
		updateOnScreenVolume(newVol);
	});

	this['checkSonglistHeightChange'] = setInterval(function() {
		if ($( window ).width() > 767) {
			$('.chatbox,.song-container').height($( window ).height()-235);
		} else {
			$('.chatbox,.song-container').removeAttr('style');
		}
	}, 1000);
	initModeration();
</script>